{% extends "base.html" %}

{% block title %}Document Details - Historical Archive{% endblock %}

{% block content %}
<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('documents') }}">Documents</a></li>
        <li class="breadcrumb-item active">{{ document.title }}</li>
    </ol>
</nav>

<!-- Document Header -->
<div class="row mb-4">
    <div class="col-md-8">
        <h1 class="display-5">{{ document.title }}</h1>
        <p class="lead text-muted">{{ document.description }}</p>
    </div>
    <div class="col-md-4 text-end">
        <span class="badge bg-success fs-6">{{ document.status }}</span>
    </div>
</div>

<!-- Document Metadata -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Document Information</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <dl class="row">
                    <dt class="col-sm-4">Date:</dt>
                    <dd class="col-sm-8">{{ document.date }}</dd>
                    
                    <dt class="col-sm-4">Collection:</dt>
                    <dd class="col-sm-8">
                        <a href="{{ url_for('collection', id=document.collection_id) }}">
                            {{ document.collection_name }}
                        </a>
                    </dd>
                    
                    <dt class="col-sm-4">Location:</dt>
                    <dd class="col-sm-8">{{ document.location }}</dd>
                    
                    <dt class="col-sm-4">Language:</dt>
                    <dd class="col-sm-8">{{ document.language }}</dd>
                </dl>
            </div>
            <div class="col-md-6">
                <dl class="row">
                    <dt class="col-sm-4">Type:</dt>
                    <dd class="col-sm-8">{{ document.type }}</dd>
                    
                    <dt class="col-sm-4">Format:</dt>
                    <dd class="col-sm-8">{{ document.format }}</dd>
                    
                    <dt class="col-sm-4">Pages:</dt>
                    <dd class="col-sm-8">{{ document.page_count }}</dd>
                    
                    <dt class="col-sm-4">Added:</dt>
                    <dd class="col-sm-8">{{ document.created_at.strftime('%B %d, %Y') }}</dd>
                </dl>
            </div>
        </div>
    </div>
</div>

<!-- Document Content -->
<div class="row">
    <!-- Document Image/Viewer -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                Document Scan
            </div>
            <div class="card-body text-center">
                <img src="{{ url_for('static', filename='documents/' + document.image_path) }}" 
                     class="img-fluid" 
                     alt="{{ document.title }}">
            </div>
            <div class="card-footer">
                <div class="btn-group w-100" role="group">
                    <button type="button" class="btn btn-outline-primary">
                        <i class="bi bi-zoom-in"></i> Zoom In
                    </button>
                    <button type="button" class="btn btn-outline-primary">
                        <i class="bi bi-zoom-out"></i> Zoom Out
                    </button>
                    <a href="{{ url_for('download', id=document.id) }}" class="btn btn-outline-primary">
                        <i class="bi bi-download"></i> Download
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Transcription -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Transcription</span>
                {% if document.transcription_status == 'complete' %}
                    <span class="badge bg-success">Complete</span>
                {% else %}
                    <span class="badge bg-warning">In Progress</span>
                {% endif %}
            </div>
            <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                {% if document.transcription %}
                    <div class="transcription-text">
                        {{ document.transcription|safe }}
                    </div>
                {% else %}
                    <p class="text-muted">No transcription available yet.</p>
                    <a href="{{ url_for('contribute_transcription', id=document.id) }}" 
                       class="btn btn-primary">
                        Contribute a Transcription
                    </a>
                {% endif %}
            </div>
            <div class="card-footer">
                <button type="button" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-copy"></i> Copy Text
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-printer"></i> Print
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Tags and Categories -->
<div class="card mb-4">
    <div class="card-body">
        <h6 class="card-title">Tags:</h6>
        {% for tag in document.tags %}
            <a href="{{ url_for('search', tag=tag) }}" class="badge bg-secondary text-decoration-none me-1">
                {{ tag }}
            </a>
        {% endfor %}
    </div>
</div>

<!-- Related Documents -->
{% if related_documents %}
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">Related Documents</h5>
    </div>
    <div class="card-body">
        <div class="row">
            {% for related in related_documents %}
            <div class="col-md-4 mb-3">
                <div class="card">
                    <img src="{{ url_for('static', filename='documents/thumbnails/' + related.thumbnail) }}" 
                         class="card-img-top" 
                         alt="{{ related.title }}">
                    <div class="card-body">
                        <h6 class="card-title">{{ related.title }}</h6>
                        <p class="card-text small text-muted">{{ related.date }}</p>
                        <a href="{{ url_for('document', id=related.id) }}" class="btn btn-sm btn-primary">
                            View Document
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Citation Information -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">How to Cite This Document</h5>
    </div>
    <div class="card-body">
        <h6>Chicago Style:</h6>
        <p class="font-monospace small">
            {{ document.author or "Unknown" }}. "{{ document.title }}." 
            {{ document.collection_name }}, {{ document.date }}. 
            Historical Document Archive. Accessed {{ now.strftime('%B %d, %Y') }}. 
            {{ request.url }}.
        </p>
        
        <h6 class="mt-3">MLA Style:</h6>
        <p class="font-monospace small">
            {{ document.author or "Unknown" }}. "{{ document.title }}." 
            <i>{{ document.collection_name }}</i>, {{ document.date }}. 
            Historical Document Archive, {{ request.url }}. 
            Accessed {{ now.strftime('%d %b. %Y') }}.
        </p>
        
        <button class="btn btn-sm btn-outline-primary" onclick="copyCitation()">
            <i class="bi bi-clipboard"></i> Copy Citation
        </button>
    </div>
</div>

<!-- Action Buttons -->
<div class="d-flex gap-2 mb-4">
    <a href="{{ url_for('documents') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back to Documents
    </a>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#shareModal">
        <i class="bi bi-share"></i> Share
    </button>
    <button type="button" class="btn btn-outline-danger">
        <i class="bi bi-flag"></i> Report Issue
    </button>
</div>

<!-- Share Modal -->
<div class="modal fade" id="shareModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Share This Document</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Share this document:</p>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" value="{{ request.url }}" id="shareUrl" readonly>
                    <button class="btn btn-outline-secondary" type="button" onclick="copyUrl()">
                        Copy
                    </button>
                </div>
                <div class="d-grid gap-2">
                    <a href="#" class="btn btn-primary">Share on Twitter</a>
                    <a href="#" class="btn btn-primary">Share on Facebook</a>
                    <a href="mailto:?subject={{ document.title }}&body={{ request.url }}" class="btn btn-secondary">
                        Share via Email
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function copyCitation() {
    // Copy citation logic here
    alert('Citation copied to clipboard!');
}

function copyUrl() {
    const urlInput = document.getElementById('shareUrl');
    urlInput.select();
    document.execCommand('copy');
    alert('URL copied to clipboard!');
}
</script>
{% endblock %}
